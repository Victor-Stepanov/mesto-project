(()=>{"use strict";var e=function(e,t,n){var r=e.querySelector(n.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(r,n):function(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}(r,n)};function t(e){document.addEventListener("keydown",r),document.addEventListener("click",o),e.classList.add("popup_opened")}function n(e){document.removeEventListener("keydown",r),document.removeEventListener("click",o),e.classList.remove("popup_opened")}function r(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))}function o(e){e.target.classList.contains("popup_opened")&&n(e.target)}var c=document.querySelector(".popup_card"),u=document.querySelector(".popup_image"),a=document.querySelector(".popup_update-photo"),i=document.querySelector(".profile"),l=i.querySelector(".profile__edit-button"),s=i.querySelector(".profile__name"),d=i.querySelector(".profile__moniker"),f=i.querySelector(".profile__add-button"),p=document.querySelector(".popup_profile"),m=p.querySelector(".profile-form"),v=m.querySelector('input[name="name"]'),_=m.querySelector('input[name="about"]'),h=p.querySelector(".close-profile"),y=document.querySelector(".profile__avatar"),S=document.querySelector('input[name="link-photo"]'),b=document.querySelector('form[name="new-photo"]'),q=document.querySelector(".update-close"),L=c.querySelector(".close-card"),k=c.querySelector('input[name="name-card"]'),E=c.querySelector('input[name="link"]'),C=u.querySelector(".popup__figure"),g=C.querySelector(".popup__figure-image"),x=C.querySelector(".popup__figure-figcaption"),U=C.querySelector(".figure-close"),T=document.querySelector(".elements"),A=document.querySelector("#card-template").content,D=console.log,P={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"78c185d4-31af-42e6-8e64-c3782dbb21e3","Content-Type":"application/json"}},B=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function w(e,t){var n=A.querySelector(".element").cloneNode(!0),r=n.querySelector(".element__image"),o=n.querySelector(".element__name"),c=n.querySelector(".element__delete-button"),u=n.querySelector(".element__like-button"),a=A.querySelector(".element__like-counter"),i=e._id;return r.src=e.link,r.alt=e.name,o.textContent=e.name,a.textContent=e.likes.length,t!==e.owner._id&&c.remove(),e.likes.forEach((function(e){e._id===t&&u.classList.add("element__like-button_active")})),c.addEventListener("click",(function(e){var t;(t=i,fetch("".concat(P.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:P.headers}).then((function(e){return B(e)})).catch((function(e){return D("Что-то пошло не так",e)}))).then((function(t){e.target.remove()})).catch((function(e){return D("Что-то пошло не так",e)}))})),u.addEventListener("click",(function(t){var n;t.target.classList.contains("element__like-button_active")&&(n=i,fetch("".concat(P.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:P.headers}).then((function(e){return B(e)})).catch((function(e){return D("Что-то пошло не так",e)}))).then((function(t){u.classList.remove("element__like-button_active"),a.textContent=e.likes.length})).catch((function(e){return D("Ошибка",e)})),function(e){return fetch("".concat(P.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:P.headers}).then((function(e){return B(e)})).catch((function(e){return D("Ошибка",e)}))}(i).then((function(t){u.classList.add("element__like-button_active"),a.textContent=e.likes.length})).catch((function(e){return D("Ошибка",e)}))})),r.addEventListener("click",O),n}function N(e){e.preventDefault();var t,r=document.querySelector(".popup__button");r.textContent="Сохранение...",(t={name:v.value,about:_.value},fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:t,about:undefined})}).then((function(e){return B(e)})).catch((function(e){return D("Что-то пошло не так",e)}))).then((function(e){s.textContent=v.value,d.textContent=_.value,n(p)})).catch((function(e){return D("Ошибка",e.message)})).finally((function(){r.textContent="Сохранить",r.classList.add("popup__button_disabled"),r.disabled=!0}))}var O=function(e){g.src=e.target.src,g.alt=e.target.alt,x.textContent=e.target.alt,t(u)};["mouseover","click"].forEach((function(e){y.addEventListener(e,(function(){"click"===e&&t(a)}))})),l.addEventListener("click",(function(){v.value=s.textContent,_.value=d.textContent,t(p)})),h.addEventListener("click",(function(){return n(p)})),p.addEventListener("submit",N),f.addEventListener("click",(function(){return t(c)})),L.addEventListener("click",(function(){return n(c)})),c.addEventListener("submit",(function(e){e.preventDefault();var t,r=document.querySelector(".img");r.textContent="Создание...",(t={name:k.value,link:E.value},fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return B(e)})).catch((function(e){return D("Ошибка",e)}))).then((function(e){T.prepend(w(e)),n(c)})).catch((function(e){return D("При добалении card возникла ошибка",e)})).finally((function(){r.textContent="Создать",k.value="",E.value="",r.classList.add("popup__button_disabled"),r.disabled=!0}))})),U.addEventListener("click",(function(){return n(u)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=Array.from(t.querySelectorAll(n.inputSelector));e(t,r,n),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(t,o,n),e(t,r,n)}))}))}(n,t)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__input-error_active"}),p.addEventListener("submit",N),b.addEventListener("submit",(function(e){e.preventDefault();var t,r=document.querySelector(".send");r.textContent="Сохранение...",(t={avatar:S.value},fetch("".concat(P.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:t})}).then((function(e){return B(e)})).catch((function(e){return D("Что-то пошло не так",e)}))).then((function(e){y.src=S.value,n(a)})).catch((function(e){return D("Что-то пошло не так",e)})).finally((function(){S.value="",r.classList.add("popup__button_disabled"),r.disabled=!0,r.textContent="Сохранить"}))}));var j=[fetch("".concat(P.baseUrl,"/users/me"),{headers:P.headers}).then((function(e){return B(e)})).catch((function(e){return D(e)})),fetch("".concat(P.baseUrl,"/cards"),{headers:P.headers}).then((function(e){return B(e)})).catch((function(e){return D("Что-то пошло не так",e)}))];Promise.all(j).then((function(e){var t=e[0]._id;s.textContent=e[0].name,d.textContent=e[0].about,y.src=e[0].avatar,e[1].forEach((function(e){!function(e,t){var n=w(e,t);T.append(n)}(e,t)}))})).catch((function(e){return D("Ошибка при получение данных",e)})),q.addEventListener("click",(function(){return n(a)}))})();