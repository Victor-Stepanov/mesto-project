(()=>{"use strict";var e=function(e,t,n){var r=e.querySelector(n.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(r,n):function(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}(r,n)},t=document.querySelector(".popup_card"),n=document.querySelector(".popup_image"),r=document.querySelector(".popup_update-photo"),o=document.querySelector(".profile"),c=o.querySelector(".profile__edit-button"),a=o.querySelector(".profile__name"),u=o.querySelector(".profile__moniker"),i=o.querySelector(".profile__add-button"),l=document.querySelector(".popup_profile"),s=l.querySelector(".profile-form"),d=s.querySelector('input[name="name"]'),p=s.querySelector('input[name="about"]'),f=l.querySelector(".close-profile"),m=document.querySelector(".profile__avatar"),v=document.querySelector('input[name="link-photo"]'),_=document.querySelector('form[name="new-photo"]'),h=document.querySelector(".update-close"),y=t.querySelector(".close-card"),S=t.querySelector('input[name="name-card"]'),b=t.querySelector('input[name="link"]'),q=n.querySelector(".popup__figure"),L=q.querySelector(".popup__figure-image"),k=q.querySelector(".popup__figure-figcaption"),E=q.querySelector(".figure-close"),C=document.querySelector(".img"),g=document.querySelector(".edit"),x=document.querySelector(".send"),U=document.querySelector(".elements"),T=document.querySelector("#card-template").content,A=console.log,D={},P={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"78c185d4-31af-42e6-8e64-c3782dbb21e3","Content-Type":"application/json"}},B=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function w(e){document.addEventListener("keydown",O),document.addEventListener("click",j),e.classList.add("popup_opened")}function N(e){document.removeEventListener("keydown",O),document.removeEventListener("click",j),e.classList.remove("popup_opened")}function O(e){"Escape"===e.key&&N(document.querySelector(".popup_opened"))}function j(e){e.target.classList.contains("popup_opened")&&N(e.target)}var J=function(e){L.src=e.target.src,L.alt=e.target.alt,k.textContent=e.target.alt,w(n)};function H(e,t){var n=T.querySelector(".element").cloneNode(!0),r=n.querySelector(".element__image"),o=n.querySelector(".element__name"),c=n.querySelector(".element__delete-button"),a=n.querySelector(".element__like-button"),u=n.querySelector(".element__like-counter"),i=e._id;return r.src=e.link,r.alt=e.name,o.textContent=e.name,u.textContent=e.likes.length,e.owner._id!==t&&c.remove(),e.likes.forEach((function(e){e._id===t&&a.classList.add("element__like-button_active")})),c.addEventListener("click",(function(e){var t;(t=i,fetch("".concat(P.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:P.headers}).then((function(e){return B(e)}))).then((function(e){n.remove()})).catch((function(e){return A("Что-то пошло не так",e)}))})),a.addEventListener("click",(function(e){var t;e.target.classList.contains("element__like-button_active")&&(t=i,fetch("".concat(P.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:P.headers}).then((function(e){return B(e)}))).then((function(e){a.classList.remove("element__like-button_active"),u.textContent=e.likes.length})).catch((function(e){return A("Ошибка",e)})),function(e){return fetch("".concat(P.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:P.headers}).then((function(e){return B(e)}))}(i).then((function(e){a.classList.add("element__like-button_active"),u.textContent=e.likes.length,A(u.textContent)})).catch((function(e){return A("Ошибка",e)}))})),r.addEventListener("click",J),n}["mouseover","click"].forEach((function(e){m.addEventListener(e,(function(){"click"===e&&w(r)}))})),c.addEventListener("click",(function(){d.value=a.textContent,p.value=u.textContent,w(l)})),f.addEventListener("click",(function(){return N(l)})),l.addEventListener("submit",M),i.addEventListener("click",(function(){return w(t)})),y.addEventListener("click",(function(){return N(t)})),t.addEventListener("submit",(function(e){var n;e.preventDefault(),C.textContent="Создание...",(n={name:S.value,link:b.value},fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return B(e)}))).then((function(e){U.prepend(H(e,D.id)),N(t)})).catch((function(e){return A("При добалении card возникла ошибка",e)})).finally((function(){C.textContent="Создать",S.value="",b.value="",C.classList.add("popup__button_disabled"),C.disabled=!0}))})),E.addEventListener("click",(function(){return N(n)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=Array.from(t.querySelectorAll(n.inputSelector));e(t,r,n),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(t,o,n),e(t,r,n)}))}))}(n,t)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__input-error_active"});var z=[fetch("".concat(P.baseUrl,"/users/me"),{headers:P.headers}).then((function(e){return B(e)})),fetch("".concat(P.baseUrl,"/cards"),{headers:P.headers}).then((function(e){return B(e)}))];function M(e){var t,n,r;e.preventDefault(),g.textContent="Сохранение...",(t={name:d.value,about:p.value},n=t.name,r=t.about,fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return B(e)}))).then((function(e){a.textContent=d.value,u.textContent=p.value,N(l)})).catch((function(e){return A("Что-то пошло не так",e.message)})).finally((function(){g.textContent="Сохранить",g.classList.add("popup__button_disabled"),g.disabled=!0}))}Promise.all(z).then((function(e){a.textContent=e[0].name,u.textContent=e[0].about,m.src=e[0].avatar,D.id=e[0]._id,e[1].forEach((function(e){!function(e,t){var n=H(e,t);U.append(n)}(e,D.id)}))})).catch((function(e){return A("Ошибка при получение данных",e)})),l.addEventListener("submit",M),_.addEventListener("submit",(function(e){var t,n;e.preventDefault(),x.textContent="Сохранение...",(t={avatar:v.value},n=t.avatar,fetch("".concat(P.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:n})}).then((function(e){return B(e)}))).then((function(e){m.src=v.value,N(r)})).catch((function(e){return A("Что-то пошло не так",e)})).finally((function(){v.value="",x.classList.add("popup__button_disabled"),x.disabled=!0,x.textContent="Сохранить"}))})),h.addEventListener("click",(function(){return N(r)}))})();